with some fixes for selfusing

original https://bitbucket.org/anticensority/antizapret-pac-generator-light